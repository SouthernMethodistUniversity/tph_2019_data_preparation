To import Reddit JSON data into Postgres
----------------------------------------

UNRESOLVED: The JSON files have single backslashes. A single backslash must be escaped, so all files need to be processed to replace single backslashes with double backslashes. This may be by modifying the files (may be good investment to make future imports faster) or possibly using sed or PowerShell as part of the import.

Create the table:
CREATE TABLE reddit (
    rowid int GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    imported_at timestamp DEFAULT CURRENT_TIMESTAMP,
    comment jsonb NOT NULL
);

Scoop up the data:
cat [JSON file name here] | "[path to psql bin]psql" -h localhost -p 5432 --username=postgres -c "COPY reddit (comment) FROM STDIN;" reddit

Example:
cat RC_2007-10 | psql -h localhost -p 5432 --username=acambre -c "COPY reddit (comment) FROM STDIN;" reddit

You want to pull out individual fields in the JSON comment as their own columns under two circumstances:
1. The user needs to query on that field.
2. The user needs to analyze data in that field.

To do that, you'll create a column and then fill it. This is an example of creating a new id column to contain the id field of the JSON info:

ALTER TABLE reddit 
ADD COLUMN id VARCHAR;
UPDATE reddit
SET id = comment->>'id';

NOTE: Why "comment_id"? There is already an "id" column as the primary key. Maybe the id column could be renamed, allowing columns representing reddit data to retain their original names.

sed 's,\\,\\\\,g'



sbatch -p standard-mem-s --mem=250G --mail-user=acambre@smu.edu --mail-type=ALL --wrap /nfsscratch/tph_myth/data_sets/reddit_import.sh